name: Continous Deployment

on:
    push:
        branches: [ main ]

permissions:
    contents: read

jobs:
    ci-workflow:
        uses: ./.github/workflows/ci.yml
        secrets: inherit
    deploy_app:
        name: 🎉 Deploy App
        runs-on: ubuntu-latest
        steps:
        - name: 🚚 Get latest code
          uses: actions/checkout@v3
    
        - name: 🛠️ Build Ionic App
          run: |
            npm install -g @ionic/cli
            npm install
            ionic build --prod
          working-directory: ./app
    
        - name: FTP Deploy
          uses: SamKirkland/FTP-Deploy-Action@v4.3.4
          with:
            server: 34.27.203.247
            username: admin
            password: ilovehealth
            server-dir: ./home/tothemoontogether1/healthquest/www/
            local-dir: ./app/www/
